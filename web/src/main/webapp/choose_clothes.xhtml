<ui:composition template="/templates/masterLayout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <ui:define name="windowTitle">
        #{msgs.siteTitle}
    </ui:define>

    <ui:define name="content">
        <h:form prependId="false">
            <table id="mainContent">
                <tr>
                    <!--Столбец с одеждой-->
                    <td id="choose_dress" class="content_td">

                        <p:accordionPanel value="#{dressBean.dressCategories}" var="category" multiple="true">
                            <p:tab title="#{category.label}">


                                <ui:repeat value="#{category.clothesList}" var="clothesItem">
                                    <div class="likeLink"
                                         ondragend="dressGirl('#{clothesItem.image}', '#{category.label}')">
                                        <h:panelGrid columns="1">
                                            <h:graphicImage id="item"
                                                            url="/resources/img/clothes/#{clothesItem.image}_thumb.jpg"/>
                                            <h:outputText value="#{clothesItem.label}"/>
                                            <h:outputText value="Price: $100"/>
                                        </h:panelGrid>
                                        <!--<p:draggable for="item" containment="parent" />-->

                                        <br/><br/>
                                    </div>
                                </ui:repeat>


                            </p:tab>
                        </p:accordionPanel>

                    </td>

                    <!--Столбец с самим манекеном-->
                    <td id="maneken" class="content_td" style="text-align: center; height: 700px">

                        <h:graphicImage id="empty_model" url="/resources/img/empty_model.png" width="260" height="679"
                                        style="position: absolute; left: 500px; top:10px;"/>

                        <!--СКРЫТЫЕ ШМОТКИ!!!-->
                        <ui:repeat value="#{dressBean.dressCategories}" var="item">
                            <ui:repeat value="#{item.clothesList}" var="cloth">
                                <h:graphicImage url="/resources/img/clothes/#{cloth.image}.png"
                                                styleClass="#{item.label}"
                                                style="display: none; position: absolute; left: 500px; top:10px;"
                                                width="260" height="679"/>
                            </ui:repeat>

                        </ui:repeat>
                    </td>


                    <h:inputHidden id="shirtPuttedOn" name="fuck" value="false"/>
                    <h:inputHidden id="jeansPuttedOn" value="false"/>
                    <h:inputHidden id="coatPuttedOn" value="false"/>
                    <!--чудо-кнопка-->
                    <h:commandButton id="ADD_USERS_PURCHASE" style="display:none">
                        <ui:param id="var1" name="myVar1" value="xxx" />
                        <ui:param id="var2" name="myVar2" value="yyy" />

                        <script type="text/javascript">

                        </script>

                        <f:ajax listener="#{user.userAdd( myVar1 )}" render="total"/>
                    </h:commandButton>
                    <!--Столбец с тем, что выбрано-->
                    <h:panelGrid id="total" class="content_td">
                        <h:outputText value="Your sizes:" style="font-weight:bold"/>
                        <h:outputText value="Shirt size: #{user.getShirtSize()}"/>
                        <h:outputText value="Jeans size: #{user.getJeansSize()}"/>

                        <h:outputText value="Your purchases" style="font-weight:bold"/>
                        <ui:repeat value="#{user.purchases}" var="purchase">
                            <h:panelGrid>
                                <h:outputText value="Size: #{purchase.size}"/>
                                <h:outputText value="Price: #{purchase.price}$"/>
                            </h:panelGrid>
                        </ui:repeat>
                        <h:outputText id="totals" value="Total: #{user.purchasesTotal}" style="font-weight:bold"/>
                        <p:message id="iconMessage" for="totals"/>
                    </h:panelGrid>

                </tr>
            </table>


        </h:form>




        <script type="text/javascript">
            $(document).ready(function () {
                dlg.show();
            });

            function dressGirl(clothesName, category) {
                checkCategory(category, "Shirts", "shirtPuttedOn");
                checkCategory(category, "Jeans", "jeansPuttedOn");
                checkCategory(category, "Coats", "coatPuttedOn");
                $("img[src$='" + clothesName + ".png']").show();




                $("#ADD_USERS_PURCHASE").click();
            }


            function checkCategory(category, categoryname, hiddenFieldName) {

                if (category == categoryname) {
                    if ($("#" + hiddenFieldName).val() == "true") {
                        $("." + categoryname).each(function (i, obj) {
                            $(this).hide();
                        });
                    }
                    else {
                        $("#" + hiddenFieldName).val("true");
                    }
                }
            }
        </script>
    </ui:define>
</ui:composition>
